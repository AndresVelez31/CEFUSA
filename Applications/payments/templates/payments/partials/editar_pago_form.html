<form id="formEditarPago" method="POST" action="{% url 'update_pago' pago.id %}">
  {% csrf_token %}
  <div class="modal-header bg-primary text-white">
    <h5 class="modal-title">Editar Pago</h5>
    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
  </div>
  <div class="modal-body">
    <div id="mensaje-exito" style="display:none;" class="alert alert-success">
      ¡Pago actualizado correctamente!
    </div>
    {{ form.as_p }}
  </div>
  <div class="modal-footer">
    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
    <button type="submit" class="btn btn-primary">Guardar Cambios</button>
  </div>
</form>


<script>
function bindEditarPagoForm() {
  const form = document.getElementById('formEditarPago');
  if (form) {
    form.addEventListener('submit', function(e) {
      e.preventDefault();
      fetch(form.action, {
        method: 'POST',
        body: new FormData(form),
        headers: {'X-Requested-With': 'XMLHttpRequest'}
      })
      .then(response => response.json())
        .then(data => {
          if (data.success) {
            document.getElementById('mensaje-exito').style.display = 'block';
            // Solo mostrar el mensaje de éxito dentro del modal, sin cerrar el modal ni recargar la página
        } else {
          document.getElementById('editarPagoModalContent').innerHTML = data.html;
          // Re-asocia el evento tras re-render
          setTimeout(bindEditarPagoForm, 100);
        }
      });
    });
  }
}
// Ejecuta la función cada vez que se carga el modal
bindEditarPagoForm();
</script>